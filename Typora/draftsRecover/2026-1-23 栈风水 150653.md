# 前言

栈风水，实际上是对于所有栈知识的灵活组合运用。所以重在灵活变通

这道题的栈风水在于利用任意地址写，实现任意次数的任意地址写，并且在程序使用start的时候会在栈上留下libc的地址，通过修改libc的地址，爆破使得地址泄漏；不过由于爆破需要非常多的时间，所以我会关闭地址随机化；

# 题: 

我们来说一下这个题吧

程序非常简单：只有一个main函数，并且仅仅溢出0x10的字节，，所以仅仅够覆盖返回地址，并且程序里面并没有给出任何后门函数

```assembly
.text:0000000000401288 ; int __fastcall main(int argc, const char **argv, const char **envp)
.text:0000000000401288                 public main
.text:0000000000401288 main            proc near               ; DATA XREF: _start+18↑o
.text:0000000000401288
.text:0000000000401288 buf             = byte ptr -8
.text:0000000000401288
.text:0000000000401288 ; __unwind {
.text:0000000000401288                 endbr64
.text:000000000040128C                 push    rbp
.text:000000000040128D                 push    rbx
.text:000000000040128E                 mov     rbp, rsp
.text:0000000000401291                 sub     rsp, 8
.text:0000000000401295                 mov     rdi, 0          ; fd
.text:000000000040129C                 lea     rsi, [rbp+buf]  ; buf
.text:00000000004012A0                 mov     rdx, 20h ; ' '  ; nbytes
.text:00000000004012A7                 call    _read
.text:00000000004012AC                 add     rsp, 8
.text:00000000004012B0                 pop     rbx
.text:00000000004012B1                 pop     rbp
.text:00000000004012B2                 retn
.text:00000000004012B2 main            endp
```

那么我们应该是可以注意到程序收栈的结构和我们正常的`leave ret`不太一样，这里的效果相当于`leave ret` ，但是不涉及到rbp， 也就是说rbp不影响栈。那么这里就有一个有意思的东西了，

看到这部分汇编：我们会发现

```assembly
.text:0000000000401295                 mov     rdi, 0          ; fd
.text:000000000040129C                 lea     rsi, [rbp+buf]  ; buf
.text:00000000004012A0                 mov     rdx, 20h ; ' '  ; nbytes
.text:00000000004012A7                 call    _read
```

